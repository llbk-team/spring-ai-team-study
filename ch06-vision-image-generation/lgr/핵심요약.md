# Spring ì •ë¦¬ ë…¸íŠ¸

## ğŸ“Œ ëª©ì°¨
1. [REST API í´ë¼ì´ì–¸íŠ¸ ì¢…ë¥˜](#rest-api-í´ë¼ì´ì–¸íŠ¸-ì¢…ë¥˜)
2. [Monoì™€ Fluxì˜ ì°¨ì´ì ](#monoì™€-fluxì˜-ì°¨ì´ì )
3. [Spring Web vs Reactive Web](#spring-web-vs-reactive-web)
4. [FormDataì˜ ì—­í• ](#formdataì˜-ì—­í• )
5. [ImageModel ì¸í„°í˜ì´ìŠ¤](#imagemodel-ì¸í„°í˜ì´ìŠ¤)
6. [ImageMessage í´ë˜ìŠ¤](#imagemessage-í´ë˜ìŠ¤)

---

## REST API í´ë¼ì´ì–¸íŠ¸ ì¢…ë¥˜

Springì—ì„œ ì™¸ë¶€ REST APIë¥¼ í˜¸ì¶œí•˜ëŠ” ë°©ë²•ì€ í¬ê²Œ 3ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤.

### 1. RestTemplate
- **ì²˜ë¦¬ ë°©ì‹**: ë™ê¸° ë°©ì‹ (Synchronous)
- **íŠ¹ì§•**: 
  - Spring 3.0ë¶€í„° ì‚¬ìš©
  - ì „í†µì ì¸ ë°©ì‹
  - Spring 5ë¶€í„° maintenance ëª¨ë“œ
  - ìƒˆ í”„ë¡œì íŠ¸ì—ëŠ” ê¶Œì¥í•˜ì§€ ì•ŠìŒ

```java
@Service
public class ApiService {
    @Autowired
    private RestTemplate restTemplate;
    
    public String getData() {
        return restTemplate.getForObject(url, String.class);
    }
}
```

### 2. WebClient â­ (ê¶Œì¥)
- **ê¸°ë°˜**: Spring WebFlux
- **ì²˜ë¦¬ ë°©ì‹**: ë¹„ë™ê¸° + ë™ê¸° ëª¨ë‘ ì§€ì›
- **íŠ¹ì§•**:
  - Non-blocking
  - í˜„ëŒ€ì ì´ê³  ìœ ì—°í•¨
  - ë°˜ì‘í˜• í”„ë¡œê·¸ë˜ë° ì§€ì›
  - ê°€ì¥ ê¶Œì¥ë˜ëŠ” ë°©ì‹

```java
@Service
public class ApiService {
    @Autowired
    private WebClient webClient;
    
    // ë™ê¸° ë°©ì‹
    public String getDataSync() {
        return webClient.get()
            .uri("/data")
            .retrieve()
            .bodyToMono(String.class)
            .block();  // ë™ê¸° ì²˜ë¦¬
    }
    
    // ë¹„ë™ê¸° ë°©ì‹
    public Mono<String> getDataAsync() {
        return webClient.get()
            .uri("/data")
            .retrieve()
            .bodyToMono(String.class);
    }
}
```

### 3. RestClient
- **ë²„ì „**: Spring 6.1+ (Spring Boot 3.2+)
- **ì²˜ë¦¬ ë°©ì‹**: ë™ê¸° ë°©ì‹
- **íŠ¹ì§•**:
  - RestTemplateì˜ í˜„ëŒ€ì  ëŒ€ì²´
  - ê°„ë‹¨í•œ API
  - ë™ê¸° ì²˜ë¦¬ì— ìµœì í™”

```java
@Service
public class ApiService {
    private final RestClient restClient;
    
    public String getData() {
        return restClient.get()
            .uri("/data")
            .retrieve()
            .body(String.class);
    }
}
```

---

## Monoì™€ Fluxì˜ ì°¨ì´ì 

Spring WebFluxì—ì„œ ì‚¬ìš©í•˜ëŠ” ë°˜ì‘í˜•(Reactive) íƒ€ì…ì…ë‹ˆë‹¤.

### Mono<T>
- **ë°˜í™˜ ê°œìˆ˜**: 0ê°œ ë˜ëŠ” 1ê°œ
- **ìš©ë„**: ë‹¨ì¼ ì‘ë‹µ
- **ë¹„ìœ **: `Optional<T>` ë˜ëŠ” ë‹¨ì¼ ê°’

```java
// ë‹¨ì¼ ì‚¬ìš©ì ì¡°íšŒ
Mono<User> findById(Long id)

// ì €ì¥ (1ê°œ ë°˜í™˜)
Mono<User> save(User user)

// ì‚­ì œ (ê²°ê³¼ ì—†ìŒ)
Mono<Void> delete(Long id)

// ê°œìˆ˜ ì„¸ê¸°
Mono<Long> count()
```

### Flux<T>
- **ë°˜í™˜ ê°œìˆ˜**: 0ê°œ ~ Nê°œ (ë¬´í•œëŒ€ ê°€ëŠ¥)
- **ìš©ë„**: ìŠ¤íŠ¸ë¦¼ ì‘ë‹µ (ì»¬ë ‰ì…˜)
- **ë¹„ìœ **: `List<T>` ë˜ëŠ” `Stream<T>`

```java
// ì—¬ëŸ¬ ì‚¬ìš©ì ì¡°íšŒ
Flux<User> findAll()

// ê²€ìƒ‰ ê²°ê³¼ (ì—¬ëŸ¬ ê°œ)
Flux<User> search(String keyword)

// ìŠ¤íŠ¸ë¦¬ë° ë°ì´í„°
Flux<Event> subscribeToEvents()
```

### ë¹„êµí‘œ

| êµ¬ë¶„ | Mono | Flux |
|------|------|------|
| ë°˜í™˜ ê°œìˆ˜ | 0 ë˜ëŠ” 1ê°œ | 0 ~ Nê°œ |
| ì‘ë‹µ í˜•íƒœ | ë‹¨ì¼ ì‘ë‹µ | ìŠ¤íŠ¸ë¦¼ ì‘ë‹µ |
| ì‚¬ìš© ì˜ˆ | ë‹¨ì¼ ì¡°íšŒ, ì €ì¥ | ëª©ë¡ ì¡°íšŒ, ê²€ìƒ‰ |

---

## Spring Web vs Reactive Web

### Spring Web (MVC) - ë™ê¸° ë°©ì‹
- **íŠ¹ì§•**:
  - ì „í†µì ì¸ Servlet ê¸°ë°˜
  - ë™ê¸° ì²˜ë¦¬ (Synchronous)
  - Thread per Request ëª¨ë¸
  - Blocking I/O

```java
@RestController
public class UserController {
    
    @GetMapping("/users/{id}")
    public User getUser(@PathVariable Long id) {
        return userService.findById(id);  // ë™ê¸° ë°©ì‹
    }
}
```

### Spring Reactive Web (WebFlux) - ë¹„ë™ê¸° ë°©ì‹
- **íŠ¹ì§•**:
  - Netty ê¸°ë°˜
  - ë¹„ë™ê¸° ì²˜ë¦¬ (Asynchronous)
  - Event Loop ëª¨ë¸
  - Non-blocking I/O
  - ë†’ì€ ë™ì‹œì„± ì²˜ë¦¬

```java
@RestController
public class UserController {
    
    @GetMapping("/users/{id}")
    public Mono<User> getUser(@PathVariable Long id) {
        return userService.findById(id);  // ë¹„ë™ê¸° ë°©ì‹
    }
}
```

### ë¹„êµí‘œ

| êµ¬ë¶„ | Spring Web (MVC) | Spring Reactive Web (WebFlux) |
|------|------------------|-------------------------------|
| ì²˜ë¦¬ ë°©ì‹ | ë™ê¸° (Synchronous) | ë¹„ë™ê¸° (Asynchronous) |
| ê¸°ë°˜ | Servlet | Netty |
| I/O ëª¨ë¸ | Blocking | Non-blocking |
| ë°˜í™˜ íƒ€ì… | ì¼ë°˜ ê°ì²´ | Mono, Flux |
| ì‚¬ìš© ì‚¬ë¡€ | ì „í†µì ì¸ CRUD | ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°, ê³ ì„±ëŠ¥ |

---

## FormDataì˜ ì—­í• 

### ê°œë…
FormDataëŠ” í¼ ë°ì´í„°ë¥¼ í‚¤-ê°’ ìŒìœ¼ë¡œ ì‰½ê²Œ êµ¬ì„±í•˜ì—¬ ì„œë²„ë¡œ ì „ì†¡í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” JavaScript ê°ì²´ì…ë‹ˆë‹¤.

### ì£¼ìš” ì—­í• 
1. **í…ìŠ¤íŠ¸(description) + íŒŒì¼(ì´ë¯¸ì§€ Blob)ì„ í•¨ê»˜ ì „ì†¡**
   - ì¼ë°˜ í…ìŠ¤íŠ¸ ë°ì´í„°
   - íŒŒì¼(ì´ë¯¸ì§€, ë¬¸ì„œ ë“±)
   - ì—¬ëŸ¬ ë°ì´í„°ë¥¼ í•˜ë‚˜ì˜ ìš”ì²­ìœ¼ë¡œ ë¬¶ì–´ì„œ ì „ì†¡

2. **ìë™ ì¸ì½”ë”©**
   - `multipart/form-data` í˜•ì‹ìœ¼ë¡œ ìë™ ì¸ì½”ë”©
   - boundary(ê²½ê³„ì„ ) ìë™ ìƒì„±
   - ë¸Œë¼ìš°ì €ê°€ Content-Type ìë™ ì„¤ì •

### ì‚¬ìš© ì˜ˆì‹œ

```javascript
// FormData ìƒì„±
const formData = new FormData();

// í…ìŠ¤íŠ¸ ì¶”ê°€
formData.append("description", "ê·€ì—¬ìš´ ê³ ì–‘ì´");

// íŒŒì¼ ì¶”ê°€
const file = document.getElementById("file").files[0];
formData.append("image", file);

// ì„œë²„ë¡œ ì „ì†¡
fetch("/api/upload", {
    method: "POST",
    body: formData  // Content-Typeì€ ìë™ ì„¤ì •ë¨
});
```

### ì „ì†¡ í˜•ì‹

```
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4

------WebKitFormBoundary7MA4
Content-Disposition: form-data; name="description"

ê·€ì—¬ìš´ ê³ ì–‘ì´
------WebKitFormBoundary7MA4
Content-Disposition: form-data; name="image"; filename="cat.png"
Content-Type: image/png

[ì´ë¯¸ì§€ ë°”ì´ë„ˆë¦¬ ë°ì´í„°]
------WebKitFormBoundary7MA4--
```

---

## ImageModel ì¸í„°í˜ì´ìŠ¤

### ê°œë…
Spring AIì˜ ImageModelì€ ì´ë¯¸ì§€ ìƒì„± AI ëª¨ë¸ì„ ìœ„í•œ ì¸í„°í˜ì´ìŠ¤ì…ë‹ˆë‹¤.

### íŠ¹ì§•
- **ì±— ëª¨ë¸ê³¼ ìœ ì‚¬í•œ ì‚¬ìš© ë°©ì‹**
  - ChatModel: í…ìŠ¤íŠ¸ ê¸°ë°˜ ëŒ€í™”
  - ImageModel: ì´ë¯¸ì§€ ìƒì„±
- **í†µì¼ëœ ì¸í„°í˜ì´ìŠ¤ ì œê³µ**

### ë©”ì„œë“œ

#### call() ë©”ì„œë“œ
- **ìš©ë„**: ì´ë¯¸ì§€ ìƒì„± ìš”ì²­
- **íŠ¹ì§•**: ì´ë¯¸ì§€ëŠ” `call()` ë©”ì„œë“œë§Œ ì œê³µ (stream ì—†ìŒ)
- **ë°˜í™˜**: ìƒì„±ëœ ì´ë¯¸ì§€

```java
@Service
public class ImageService {
    
    @Autowired
    private ImageModel imageModel;
    
    public ImageResponse generateImage(String prompt) {
        ImagePrompt imagePrompt = new ImagePrompt(prompt);
        
        // call() ë©”ì„œë“œë¡œ ì´ë¯¸ì§€ ìƒì„±
        return imageModel.call(imagePrompt);
    }
}
```

### ChatModel vs ImageModel

| êµ¬ë¶„ | ChatModel | ImageModel |
|------|-----------|------------|
| ì…ë ¥ | í…ìŠ¤íŠ¸ | í…ìŠ¤íŠ¸ í”„ë¡¬í”„íŠ¸ |
| ì¶œë ¥ | í…ìŠ¤íŠ¸ ì‘ë‹µ | ì´ë¯¸ì§€ |
| ë©”ì„œë“œ | `call()`, `stream()` | `call()` ë§Œ |
| ìŠ¤íŠ¸ë¦¬ë° | ì§€ì› (ì ì§„ì  ì‘ë‹µ) | ë¯¸ì§€ì› |

---

## ImageMessage í´ë˜ìŠ¤

### ê°œë…
ì´ë¯¸ì§€ ìƒì„± ì‹œ ì‚¬ìš©ë˜ëŠ” ë©”ì‹œì§€ í´ë˜ìŠ¤ë¡œ, í…ìŠ¤íŠ¸ì™€ ê°€ì¤‘ì¹˜ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.

### êµ¬ì„± ìš”ì†Œ

#### 1. í…ìŠ¤íŠ¸ (Text)
- ì´ë¯¸ì§€ ìƒì„±ì— ì‚¬ìš©ë  í”„ë¡¬í”„íŠ¸
- ìƒì„±í•˜ê³  ì‹¶ì€ ì´ë¯¸ì§€ì— ëŒ€í•œ ì„¤ëª…

#### 2. ê°€ì¤‘ì¹˜ (Weight)
- ê° ìš”ì†Œì˜ ì¤‘ìš”ë„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê°’
- **ë†’ì€ ê°€ì¤‘ì¹˜ â†’ ë‚®ì€ ê°€ì¤‘ì¹˜ ìˆœìœ¼ë¡œ ì´ë¯¸ì§€ ìƒì„±**
- ì´ë¯¸ì§€ ìƒì„± ì‹œ ìš°ì„ ìˆœìœ„ ê²°ì •

### ì‚¬ìš© ì˜ˆì‹œ

```java
@Service
public class ImageService {
    
    @Autowired
    private ImageModel imageModel;
    
    public ImageResponse generateWeightedImage() {
        // ê°€ì¤‘ì¹˜ê°€ ë†’ì€ ìš”ì†Œë¶€í„° ì ìš©
        ImageMessage message1 = new ImageMessage(
            "cute cat",     // í…ìŠ¤íŠ¸
            2.0             // ê°€ì¤‘ì¹˜ (ë†’ìŒ)
        );
        
        ImageMessage message2 = new ImageMessage(
            "wearing glasses",  // í…ìŠ¤íŠ¸
            1.5                 // ê°€ì¤‘ì¹˜ (ì¤‘ê°„)
        );
        
        ImageMessage message3 = new ImageMessage(
            "sitting on chair",  // í…ìŠ¤íŠ¸
            1.0                  // ê°€ì¤‘ì¹˜ (ë‚®ìŒ)
        );
        
        // ê°€ì¤‘ì¹˜ ìˆœì„œ: cute cat (2.0) â†’ wearing glasses (1.5) â†’ sitting on chair (1.0)
        ImagePrompt prompt = new ImagePrompt(
            List.of(message1, message2, message3)
        );
        
        return imageModel.call(prompt);
    }
}
```

### ê°€ì¤‘ì¹˜ ë™ì‘ ë°©ì‹

```
ê°€ì¤‘ì¹˜: ë†’ìŒ â†’ ë‚®ìŒ ìˆœìœ¼ë¡œ ì´ë¯¸ì§€ ìƒì„±

ì˜ˆì‹œ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ "cute cat"          (ê°€ì¤‘ì¹˜ 2.0) â”‚  â† ê°€ì¥ ê°•í•˜ê²Œ ë°˜ì˜
â”‚ "wearing glasses"   (ê°€ì¤‘ì¹˜ 1.5) â”‚  â† ì¤‘ê°„ ë°˜ì˜
â”‚ "sitting on chair"  (ê°€ì¤‘ì¹˜ 1.0) â”‚  â† ì•½í•˜ê²Œ ë°˜ì˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ê²°ê³¼: ê·€ì—¬ìš´ ê³ ì–‘ì´ê°€ ê°€ì¥ ë‘ë“œëŸ¬ì§€ê³ ,
      ì•ˆê²½ì„ ì“´ ëª¨ìŠµì´ ë‹¤ìŒìœ¼ë¡œ ê°•ì¡°ë˜ë©°,
      ì˜ìì— ì•‰ì€ ëª¨ìŠµì€ ë°°ê²½ì²˜ëŸ¼ í‘œí˜„ë¨
```

### ì‹¤ì „ íŒ

```java
// ëª…í™•í•œ ì£¼ì œ ì„¤ì • (ë†’ì€ ê°€ì¤‘ì¹˜)
ImageMessage mainSubject = new ImageMessage("portrait of a woman", 2.0);

// ìŠ¤íƒ€ì¼ ì§€ì • (ì¤‘ê°„ ê°€ì¤‘ì¹˜)
ImageMessage style = new ImageMessage("oil painting style", 1.5);

// ë°°ê²½ ì„¤ì • (ë‚®ì€ ê°€ì¤‘ì¹˜)
ImageMessage background = new ImageMessage("sunset background", 1.0);

// ê°€ì¤‘ì¹˜ ìˆœì„œëŒ€ë¡œ ì´ë¯¸ì§€ ìƒì„±
ImagePrompt prompt = new ImagePrompt(
    List.of(mainSubject, style, background)
);
```

---

## ğŸ“š ì°¸ê³  ìë£Œ

- Spring Framework Documentation
- Spring WebFlux Guide
- Spring AI Documentation
- Reactive Programming Guide

---

## ğŸ“ í•™ìŠµ ì •ë¦¬

### í•µì‹¬ ê°œë…
1. **ë¹„ë™ê¸° ì²˜ë¦¬**: WebClientì™€ WebFluxë¥¼ í™œìš©í•œ ë°˜ì‘í˜• í”„ë¡œê·¸ë˜ë°
2. **Mono vs Flux**: ë‹¨ì¼ ì‘ë‹µê³¼ ìŠ¤íŠ¸ë¦¼ ì‘ë‹µì˜ ì°¨ì´ ì´í•´
3. **FormData**: íŒŒì¼ê³¼ í…ìŠ¤íŠ¸ë¥¼ í•¨ê»˜ ì „ì†¡í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜
4. **ImageModel**: AI ì´ë¯¸ì§€ ìƒì„±ì„ ìœ„í•œ í†µì¼ëœ ì¸í„°í˜ì´ìŠ¤
5. **ê°€ì¤‘ì¹˜**: ì´ë¯¸ì§€ ìƒì„± ì‹œ ìš”ì†Œë³„ ì¤‘ìš”ë„ ì¡°ì ˆ

### ì‹¤ë¬´ ì ìš©
- REST API í´ë¼ì´ì–¸íŠ¸ëŠ” **WebClient ì‚¬ìš© ê¶Œì¥**
- ë¹„ë™ê¸° ì²˜ë¦¬ê°€ í•„ìš”í•˜ë©´ **WebFlux + Mono/Flux** ì‚¬ìš©
- íŒŒì¼ ì—…ë¡œë“œëŠ” **FormData + multipart/form-data** í™œìš©
- ì´ë¯¸ì§€ ìƒì„± ì‹œ **ê°€ì¤‘ì¹˜ë¥¼ í™œìš©í•œ ì„¸ë°€í•œ ì œì–´** ê°€ëŠ¥