## Map으로 변환 (MapOutputConverter)

MapOutputConverter는 LLM이 반환한 JSON 문자열을 자바의 Map 형태로 변환하기 위해 사용한다.
즉, 모델이 생성한 문자열을 자바에서 다룰 수 있는 데이터 구조로 파싱한다.

## PromptTemplate과 자리표시자

PromptTemplate은 문자열 안에 변수를 넣는 템플릿이다. {hotel}, {format}과 같은 자리표시자는 나중에 실제 값으로 치환된다.

```java
PromptTemplate promptTemplate =
    new PromptTemplate("호텔 {hotel}에 대해 정보를 알려주세요 {format}");
```

여기서 {hotel}, {format}은 아직 값 없는 빈 자리다.

```java
Prompt prompt = promptTemplate.create(Map.of(
    "hotel", hotel,
    "format", mapOutputConverter.getFormat()));
```

Map.of()를 사용하여 템플릿의 변수명과 실제 값을 매핑하여 자리표시자에 실제 데이터를 주입한다.

또한 `getFormat()`으로 LLM에게 이런 구조로 JSON을 출력하라는 명시적으로 지시한다.

## LLM 응답과 변환

```java
String json = chatClient.prompt(prompt)
      .call()
      .content();
```

LLM에게 완성된 프롬프트를 전송하고, JSON 형태로 응답 받는다.

```java
mapOutputConverter.convert(json);
```

응답받은 문자열(JSON)을 Map<String, Object>로 역직렬화 하여, 문자열을 자바의 키-값 형태의 객체로 변환한다.

## 저수준과 고수준

- 저수준 방식

  - 저수준 방식은 직접 프롬프트를 만들고, LLM의 응답을 문자열로 받은 뒤 수동으로 변환한다.
  - 프롬프트 구성과 변환 과정을 세밀하게 제어할 수 있다.

- 고수준 방식

  - 고수준 방식은 `.entity(new MapOutputConverter())` 한 줄로 LLM호출과 응답파싱을 동시에 처리한다.
  - 코드가 간결하지만 내부 동작 제어가 어렵다.

- 주의점
  - 고수준 방식은 LLM이 JSON 형식을 생략할수도 있기 때문에 프롬프트에 출력 형식을 추가하는 것이 더 안전하다.
