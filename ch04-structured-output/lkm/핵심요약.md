## 🧭 **핵심내용**

구조화된 출력을 **고수준(high-level)** 으로 구현할 때 사용하는 `entity()` 메소드는,  
저수준 방식에서 개별적으로 작성하는 `getFormat()` 과 `convert()` 메소드의 역할을 **모두 수행한다.**  

즉, `entity()` 는 **LLM의 문자열 출력을 JSON 형태로 변환하고, 이를 Java 객체로 역직렬화(deserialize)** 하는 과정을 한 번에 수행한다.  

이때 반환 타입에 따라 처리 방식이 달라진다:

- **단일 객체 반환 시** → `entity(객체명.class)`  
  - 예: `.entity(ReviewClassification.class)`  
  - 타입 정보가 명확하므로 클래스 타입만 넘겨도 충분하다.

- **제네릭 타입 반환 시** → `entity(출력 변환기 생성자)`  
  - 예: `.entity(new MapOutputConverter())`, `.entity(new ListOutputConverter<>())`  
  - 제네릭 타입(`List<T>`, `Map<K,V>`)은 **타입 소거(Type Erasure)** 때문에 런타임에 내부 타입 정보가 사라지므로,  
    변환기를 사용해 구조를 명시적으로 알려준다.

---

## 🧩 **MapOutputConverter**

`MapOutputConverter` 는  
LLM의 JSON 응답을 **`Map<String, Object>` 형태로 변환**해주는 출력 변환기이다.  

즉, 모델이 반환한 JSON을 자동으로 파싱하여 `key-value` 구조의 자바 맵으로 만들어 준다.  
이를 통해 JSON 응답의 필드 개수나 구조가 유동적인 경우에도 안전하게 데이터를 처리할 수 있다.
